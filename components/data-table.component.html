<div class="data-table-container">
  <!-- Search Section -->
  <div class="table-header" *ngIf="showSearch">
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        placeholder="Search..."
        [value]="searchTerm"
        (input)="onSearch($event.target.value)"
        [attr.aria-label]="'Search table data'"
      />
      <button
        type="button"
        class="search-clear-btn"
        *ngIf="searchTerm"
        (click)="onSearch('')"
        [attr.aria-label]="'Clear search'"
      >
        Ã—
      </button>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-wrapper">
    <table class="data-table" role="table" [attr.aria-label]="'Data table with ' + filteredData.length + ' rows'">
      <thead>
        <tr role="row">
          <th
            *ngFor="let column of columns; trackBy: trackByIndex"
            role="columnheader"
            [class.sortable]="column.sortable"
            [style.width]="column.width"
            [attr.aria-sort]="getSortAriaLabel(column)"
            (click)="onSort(column)"
          >
            <div class="column-header">
              <span>{{ column.label }}</span>
              <span
                *ngIf="column.sortable"
                class="sort-icon"
                [class.active]="sortColumn === column.key"
                [attr.aria-hidden]="true"
              >
                {{ getSortIcon(column) }}
              </span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let row of paginatedData; trackBy: trackByIndex; let i = index"
          role="row"
          class="table-row"
          [class.clickable]="rowClick.observers.length > 0"
          (click)="onRowClick(row)"
          [attr.aria-rowindex]="i + 1"
        >
          <td
            *ngFor="let column of columns; trackBy: trackByIndex"
            role="gridcell"
            class="table-cell"
          >
            <ng-container [ngSwitch]="column.type">
              <span *ngSwitchDefault>{{ row[column.key] }}</span>
              <input
                *ngSwitchCase="'checkbox'"
                type="checkbox"
                [checked]="row[column.key]"
                [disabled]="true"
                [attr.aria-label]="column.label + ' for row ' + (i + 1)"
              />
              <span
                *ngSwitchCase="'date'"
                [title]="row[column.key] | date:'full'"
              >
                {{ row[column.key] | date:'short' }}
              </span>
            </ng-container>
          </td>
        </tr>
        
        <!-- Empty State -->
        <tr *ngIf="paginatedData.length === 0 && !loading" class="empty-row">
          <td [attr.colspan]="columns.length" class="empty-cell">
            <div class="empty-state">
              <p>No data available</p>
              <button
                *ngIf="searchTerm"
                type="button"
                class="clear-search-btn"
                (click)="onSearch('')"
              >
                Clear search
              </button>
            </div>
          </td>
        </tr>
        
        <!-- Loading State -->
        <tr *ngIf="loading" class="loading-row">
          <td [attr.colspan]="columns.length" class="loading-cell">
            <div class="loading-spinner" role="status" aria-label="Loading data">
              <span class="spinner"></span>
              <span class="loading-text">Loading...</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Section -->
  <div class="table-footer" *ngIf="showPagination && totalPages > 1">
    <div class="pagination-info">
      <span>
        Showing {{ (currentPage - 1) * pageSize + 1 }} to 
        {{ Math.min(currentPage * pageSize, filteredData.length) }} of 
        {{ filteredData.length }} entries
      </span>
    </div>
    
    <nav class="pagination" role="navigation" aria-label="Table pagination">
      <button
        type="button"
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="onPageChange(currentPage - 1)"
        [attr.aria-label]="'Go to previous page'"
      >
        Previous
      </button>
      
      <button
        *ngFor="let page of getPageNumbers(); trackBy: trackByIndex"
        type="button"
        class="pagination-btn page-number"
        [class.active]="page === currentPage"
        (click)="onPageChange(page)"
        [attr.aria-label]="'Go to page ' + page"
        [attr.aria-current]="page === currentPage ? 'page' : null"
      >
        {{ page }}
      </button>
      
      <button
        type="button"
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="onPageChange(currentPage + 1)"
        [attr.aria-label]="'Go to next page'"
      >
        Next
      </button>
    </nav>
  </div>
</div>